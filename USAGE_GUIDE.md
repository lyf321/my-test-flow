# 工作流编辑器使用指南

## 快速开始

1. 启动项目：
```bash
npm install
npm run dev
```

2. 打开浏览器访问：http://localhost:3001

3. 切换到 "Vue Flow" 标签页查看新的工作流编辑器

## 基础操作

### 查看示例工作流
项目启动后会自动加载一个示例工作流，包含：
- 1 个开始节点
- 2 个大场景节点（其中一个包含小场景）
- 1 个入戏引导节点
- 1 个出戏引导节点
- 1 个结束节点

### 添加新节点

#### 方法 1：从现有节点添加
1. 点击选中一个节点
2. 如果该节点没有后续连接，右侧会出现蓝色加号按钮 ➕
3. 点击加号，弹出节点选择器
4. 选择要添加的节点类型（只显示符合连线规则的类型）
5. 新节点会自动创建并连接

#### 方法 2：在连线中间插入
1. 将鼠标悬停在任意连线上
2. 连线中点会出现蓝色加号按钮 ➕
3. 点击加号，弹出节点选择器
4. 选择"大场景"节点（连线中间只能插入大场景）
5. 新节点会插入到连线中间

#### 方法 3：从操作栏添加
1. 点击右上角的"新增节点"按钮
2. 在画布中心弹出节点选择器
3. 选择任意节点类型
4. 手动拖拽节点到合适位置
5. 手动创建连线（从源节点的连接点拖拽到目标节点）

### 管理大场景的小场景

1. 点击大场景节点
2. 右侧边栏会自动打开
3. 查看现有的小场景列表
4. 点击"+ 添加小场景"按钮添加新的小场景
5. 点击小场景右侧的 × 按钮删除小场景
6. 小场景数量会实时显示在节点上

### 整理节点布局

1. 点击右上角的"整理节点"按钮
2. 系统会自动计算节点层级
3. 按照层次关系重新排列所有节点
4. 视图会自动适应新的布局

### 视图控制

#### 缩放
- 点击右下角的 + 按钮放大
- 点击右下角的 − 按钮缩小
- 使用鼠标滚轮缩放
- 当前缩放比例显示在中间

#### 平移
- 按住鼠标左键拖拽画布
- 使用触控板手势

#### 聚焦选中节点
1. 选中一个节点
2. 点击右下角的 🎯 按钮
3. 视图会自动移动到选中节点的位置

### 删除节点

- 选中节点后按 `Delete` 或 `Backspace` 键
- 删除节点会同时删除相关的连线

### 撤销和重做

- 撤销：`Ctrl/Cmd + Z`
- 重做：`Ctrl/Cmd + Shift + Z`

## 连线规则说明

### 开始节点
- ✅ 可以连接到：大场景、入戏引导
- ❌ 只能有一条出线
- ❌ 不能有入线

### 大场景节点
- ✅ 可以连接到：大场景、入戏引导、出戏引导、结束
- ✅ 可以有多条入线和出线

### 入戏引导节点
- ✅ 只能连接到：大场景
- ✅ 可以有多条入线
- ❌ 只能有一条出线

### 出戏引导节点
- ✅ 可以连接到：大场景、结束
- ✅ 可以有多条入线
- ❌ 只能有一条出线

### 结束节点
- ✅ 可以有多条入线
- ❌ 不能有出线

## 常见问题

### Q: 为什么我不能创建某些连线？
A: 系统会自动验证连线规则。如果连线不符合规则（如形成循环、违反节点类型限制等），会被自动阻止。

### Q: 如何在连线中间添加节点？
A: 将鼠标悬停在连线上，点击出现的加号按钮。注意：连线中间只能插入大场景节点。

### Q: 小场景的信息会保存吗？
A: 小场景信息保存在节点的 data 中。当前版本在刷新页面后会重置为初始数据。如需持久化，需要实现保存功能。

### Q: 如何快速创建复杂的工作流？
A: 
1. 先添加所有需要的节点
2. 使用"整理节点"功能自动排列
3. 然后手动创建连线
4. 最后调整细节

### Q: 节点选择器为什么有时候选项很少？
A: 节点选择器会根据上下文智能过滤。例如，从入戏引导节点添加时，只能选择大场景节点。

## 最佳实践

1. **规划工作流结构**
   - 先在纸上或脑海中规划整体流程
   - 确定主要场景和引导节点的位置

2. **从左到右构建**
   - 从开始节点开始
   - 逐步向右添加节点
   - 保持流程的清晰性

3. **合理使用引导节点**
   - 入戏引导用于场景进入前的准备
   - 出戏引导用于场景退出后的处理

4. **管理大场景的小场景**
   - 为每个大场景添加详细的小场景
   - 使用描述字段记录重要信息

5. **定期整理布局**
   - 在添加多个节点后使用"整理节点"功能
   - 保持工作流的可读性

6. **利用快捷键**
   - 熟练使用撤销/重做快捷键
   - 使用 Delete 键快速删除节点

## 技术支持

如有问题或建议，请参考以下文档：
- [Vue Flow 官方文档](https://vueflow.dev/)
- [项目功能说明](./WORKFLOW_FEATURES.md)
- [快速开始指南](./VUE_FLOW_QUICKSTART.md)

